<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:s="http://www.sitemaps.org/schemas/sitemap/0.9"
  exclude-result-prefixes="s">

  <xsl:output method="html" encoding="UTF-8" doctype-system="about:legacy-compat" />

  <!-- ========= Helpers ========= -->
  <xsl:template name="styles">
    <style>
      html { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, sans-serif; }
      body { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
      h1 { font-size: 1.75rem; margin: 0 0 0.25rem; }
      p.lead { color: #444; margin: 0 0 1rem; }
      .meta { color: #666; font-size: .9rem; margin-bottom: 1.5rem; }
      table { width: 100%; border-collapse: collapse; }
      th, td { padding: .65rem .75rem; border-bottom: 1px solid #eee; vertical-align: top; }
      th { text-align: left; background: #fafafa; font-weight: 600; }
      tr:hover td { background: #f8fbff; }
      .badge { display:inline-block; padding:.1rem .45rem; border:1px solid #e5e5e5; border-radius:.375rem; font-size:.8rem; color:#555; }
      .muted { color:#777; }
      .nowrap { white-space: nowrap; }
      .footer { margin-top: 1.5rem; color:#777; font-size:.9rem; }
      @media (max-width:720px){
        .hide-sm { display:none; }
        td, th { padding: .55rem .5rem; }
      }
      code { background:#f6f8fa; padding:.2rem .35rem; border-radius:.35rem; }
    </style>
  </xsl:template>

  <xsl:template name="page-header">
    <h1>XML Sitemap</h1>
    <p class="lead">Este documento es una representación legible para humanos del sitemap.</p>
    <div class="meta">
      Dominio: <strong><xsl:value-of select="concat(/s:urlset/*[1]/s:loc | /s:sitemapindex/*[1]/s:loc)"/></strong>
      · Generado: <span class="nowrap"><xsl:value-of select="format-dateTime(current-dateTime(),'[Y0001]-[M01]-[D01] [H01]:[m01] UTC')"/></span>
    </div>
  </xsl:template>

  <!-- ========= Root switch: urlset vs sitemapindex ========= -->
  <xsl:template match="/">
    <html lang="es">
      <head>
        <meta charset="utf-8"/>
        <title>XML Sitemap</title>
        <xsl:call-template name="styles"/>
      </head>
      <body>
        <xsl:call-template name="page-header"/>

        <xsl:choose>
          <xsl:when test="s:urlset">
            <xsl:apply-templates select="s:urlset"/>
          </xsl:when>
          <xsl:when test="s:sitemapindex">
            <xsl:apply-templates select="s:sitemapindex"/>
          </xsl:when>
          <xsl:otherwise>
            <p>No se encontró un elemento raíz <code>urlset</code> ni <code>sitemapindex</code> del esquema de sitemaps.</p>
          </xsl:otherwise>
        </xsl:choose>

        <div class="footer">
          Consejo: este estilo es solo visual; los motores de búsqueda ignoran el XSL y consumen el XML crudo.
        </div>
      </body>
    </html>
  </xsl:template>

  <!-- ========= urlset renderer ========= -->
  <xsl:template match="s:urlset">
    <div class="badge">
      URLs totales: <xsl:value-of select="count(s:url)"/>
    </div>
    <table aria-label="Listado de URLs">
      <thead>
        <tr>
          <th style="width:55%">URL</th>
          <th class="hide-sm">Última modificación</th>
          <th class="hide-sm">Frecuencia</th>
          <th class="hide-sm">Prioridad</th>
        </tr>
      </thead>
      <tbody>
        <xsl:for-each select="s:url">
          <tr>
            <td>
              <a target="_blank" rel="noopener">
                <xsl:attribute name="href"><xsl:value-of select="s:loc"/></xsl:attribute>
                <xsl:value-of select="s:loc"/>
              </a>
            </td>
            <td class="hide-sm nowrap">
              <xsl:choose>
                <xsl:when test="normalize-space(s:lastmod)!=''"><xsl:value-of select="s:lastmod"/></xsl:when>
                <xsl:otherwise><span class="muted">—</span></xsl:otherwise>
              </xsl:choose>
            </td>
            <td class="hide-sm">
              <xsl:choose>
                <xsl:when test="normalize-space(s:changefreq)!=''"><xsl:value-of select="s:changefreq"/></xsl:when>
                <xsl:otherwise><span class="muted">—</span></xsl:otherwise>
              </xsl:choose>
            </td>
            <td class="hide-sm">
              <xsl:choose>
                <xsl:when test="normalize-space(s:priority)!=''"><xsl:value-of select="s:priority"/></xsl:when>
                <xsl:otherwise><span class="muted">—</span></xsl:otherwise>
              </xsl:choose>
            </td>
          </tr>
        </xsl:for-each>
      </tbody>
    </table>
  </xsl:template>

  <!-- ========= sitemapindex renderer ========= -->
  <xsl:template match="s:sitemapindex">
    <div class="badge">
      Sitemaps en el índice: <xsl:value-of select="count(s:sitemap)"/>
    </div>
    <table aria-label="Índice de sitemaps">
      <thead>
        <tr>
          <th style="width:60%">Sitemap</th>
          <th class="hide-sm">Última modificación</th>
        </tr>
      </thead>
      <tbody>
        <xsl:for-each select="s:sitemap">
          <tr>
            <td>
              <a target="_blank" rel="noopener">
                <xsl:attribute name="href"><xsl:value-of select="s:loc"/></xsl:attribute>
                <xsl:value-of select="s:loc"/>
              </a>
            </td>
            <td class="hide-sm nowrap">
              <xsl:choose>
                <xsl:when test="normalize-space(s:lastmod)!=''"><xsl:value-of select="s:lastmod"/></xsl:when>
                <xsl:otherwise><span class="muted">—</span></xsl:otherwise>
              </xsl:choose>
            </td>
          </tr>
        </xsl:for-each>
      </tbody>
    </table>
  </xsl:template>

</xsl:stylesheet>
